#!/usr/bin/env bash

if [[ -z $CLIPPER_PORT ]]; then
    echo '$CLIPPER_PORT not defined.' >&2
    exit 1
elif [[ -x $(which nc) ]]; then
    text=$(nc -h 2>&1)
    old='^\[v1\.10'
    gnu='GNU'
    if [[ $text =~ $old ]]; then
        # Using the original version.
        cmd='nc -q 0'
    elif [[ $text =~ $gnu ]]; then
        # Using GNU version.
        cmd='nc -c'
    elif [[ -n $text ]]; then
        # Using BSD version.
        cmd='nc'
    fi

    clip_cmd="$cmd localhost $CLIPPER_PORT"
    if [[ $1 == '-n' ]]; then
        xargs echo -n | $clip_cmd
    else
        $clip_cmd
    fi
else
    echo 'Netcat not found!' >&2
    exit 1
fi
